
参考:
- [Recording a bag from a node](https://docs.ros.org/en/foxy/Tutorials/Advanced/Recording-A-Bag-From-Your-Own-Node-CPP.html)

在工作空间下，执行下面的命令创建一个功能包 bag_recorder_nodes:
```s
  cd src
  ros2 pkg create --build-type ament_cmake bag_recorder_nodes --dependencies rclcpp rosbag2_cpp
```

编译这个功能包:
```s
  colcon build --packages-select bag_recorder_nodes
```

接下来以 bag_recorder_nodes 功能包进行测试。

### 编译规则

将下面的代码添加到 CMakeLists.txt 文件中:
```cmake
...
add_executable(data_generator_node src/data_generator_node.cpp)
ament_target_dependencies(data_generator_node rclcpp rosbag2_cpp example_interfaces)

install(TARGETS
  data_generator_node
  DESTINATION lib/${PROJECT_NAME}
)
...
```

### 构建并运行

构建
```s
  colcon build --packages-select bag_recorder_nodes
```

运行:
```s
  source install/setup.bash
  ros2 run bag_recorder_nodes simple_bag_recorder
```
执行完上面的命令后，包写入节点将在终端中挂起等待，同时会在当前目录下创建一个 my_bag 目录。(如果 my_bag 目录已存在，必须先将其删除，然后再重新创建)

### 测试

在另一个终端中执行下面的命令，这将开始发布关于该 chatter 主题的数据。当包写入节点接收到这些数据时，它会将数据写入 my_bag 包中。
```s
  ros2 run demo_nodes_cpp talker
```

终止两个节点。然后，在一个终端中启动 listener 示例节点。
```s
  ros2 run demo_nodes_cpp listener
```

在另一个终端中，播放录制的包。这时将在 listener 节点看到之前接收到的来自数据包的消息。
```s
  ros2 bag play my_bag
```
