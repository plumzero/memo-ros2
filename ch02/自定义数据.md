
这里将创建一个定时器节点，用于生成和存储自定义数据。

本测试需要依赖 example_interfaces 。它的功能包创建参考[示例接口文件](示例接口文件.md)。

在工作空间下，执行下面的命令创建一个功能包 bag_recorder_nodes2:
```s
  cd src
  ros2 pkg create --build-type ament_cmake bag_recorder_nodes2 --dependencies rclcpp rosbag2_cpp example_interfaces
```

编译这个功能包:
```s
  colcon build --packages-select bag_recorder_nodes2
```

接下来以 bag_recorder_nodes2 功能包进行测试。

### 编译规则

将下面的代码添加到 CMakeLists.txt 文件中:
```cmake
...
add_executable(simple_bag_recorder src/simple_bag_recorder.cpp)
ament_target_dependencies(simple_bag_recorder rclcpp rosbag2_cpp)

install(TARGETS
  simple_bag_recorder
  DESTINATION lib/${PROJECT_NAME}
)
...
```

### 构建并运行

构建:
```s
  colcon build --packages-select bag_recorder_nodes2
```

运行:
```s
  source install/setup.bash
  ros2 run bag_recorder_nodes2 data_generator_node
```
执行完上面的命令后，包写入节点将在终端中挂起等待，同时会在当前目录下创建一个 timed_synthetic_bag 目录。(如果 timed_synthetic_bag 目录已存在，必须先将其删除，然后再重新创建)

### 测试

待节点运行一会儿(大概30s)后，终止节点。

通过下面的命令播放创建的包:
```s
  ros2 bag play timed_synthetic_bag
```

打开第二个终端并回显 /synthetic 主题(可以看到在包中生成和存储的数据以每秒一条消息的速度打印到控制台上)。
```s
  ros2 topic echo /synthetic
```
