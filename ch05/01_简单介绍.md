
DDS 是数据分发服务的核心规范，它定义了一种用于高性能、实时、分布式系统通信的数据中心发布-订阅模型。

DDS 以数据为中心。与传统的以消息/服务为中心的中间件(如ROS1、某此MQ)不同，DDS关注的是数据本身的状态、所有权和生命周期。应用程序直接与一个虚拟的全局数据空间交互，读写数据对象，而不需要关心对方在哪里。

### 架构

DDS规范采用了两层架构，这是其强大灵活性的关键。

#### 第一层: 以数据为中心的发布-订阅层

这一层定义了应用程序如何进行通信。核心概念包括:

1.Domain & DomainParticipant:
- Domain(域)是通信的基本隔离单位。只有加入同一个域的参与者才能相互发现和通信。
- DomainParticipant(域参与者)是应用程序在 DDS 域中的代表。每个应用进程创建一个或多个参与者来加入域。

2.主题:
- 定义了通信的数据类型和主题名。例如，`TemperatureSensor`主题，其数据类型为`Temperature`(包含`sensor_id`,`value`,`timestamp`)。
- 是发布者和订阅者联系的纽带。

3.数据写入者/数据读取者:
- 发布者创建`DataWriter`来向特定主题写入数据实例。
- 订阅者创建`DataReader`来从特定主题读取数据实例。
- 一个发布者/订阅者可以管理多个DataWriter/DataReader。

4.实例:
- 主题数据类型的每个具体数据对象。例如，`Temperature` 主题下，`sensor_id=1`的数据就是一个独立的实例。DDS能跟踪每个实例的状态和历史。

5.全局数据空间:
- 一个抽象概念。所有 DataWriter 写入的数据，和所有 DataReader 读取的数据，都仿佛存在于一个共享的、全局的虚拟空间里。DDS中间件负责在背后高效地匹配和传输数据。

#### 第二层: 数据本地重建层

这一层提供了丰富的`QoS`(服务质量)机制，允许开发者精确控制通信行为，是 DDS 区别于简单 Pub/Sub 系统的核心。

DDS 定义了约 20 多种 QoS 策略，发布者和订阅者可以各自配置自己的策略。DDS中间件会进行QoS匹配，只有兼容的发布-订阅对才能建立连接。

关键 QoS 包括:
- 可靠性: `RELIABLE`(确保送达，类似TCP) vs `BEST_EFFORT`(尽力而为，类似UDP)。
- 持久性: `VOLATILE`(不保存) vs `TRANSIENT_LOCAL`(为晚加入的订阅者保留最近数据) vs `TRANSIENT`/`PERSISTENT`(跨会话持久化)。
- 历史记录：`KEEP_LAST`(保留最后N个样本) vs `KEEP_ALL`(保留所有样本，直到资源耗尽)。
- 截止时间: 数据样本必须在指定的时间间隔内被更新/接收，否则会触发超时通知。
- 生存时间: 数据样本的有效期，过期后中间件会自动丢弃。
- 资源限制: 控制内存使用，防止慢消费者拖垮系统。
- 所有权: `SHARED`(多个写入者可更新同一实例) vs `EXCLUSIVE`(只有一个"所有权强度"最高的写入者能更新，用于主备冗余)。
- 基于内容/时间的过滤: 订阅者可以只接收满足特定条件(如 `value > 100`)或特定时间窗口的数据，减少不必要的数据传输。

### 工作流程

1.发现: 域参与者加入后，DDS中间件自动在域内进行`动态发现`，匹配有共同主题且QoS兼容的DataWriter和DataReader。这个过程完全分布式，无需中央服务器。
2.通信: 匹配成功后，DataWriter写入数据，DDS中间件根据QoS策略(如可靠性、持久性)将数据高效地传递给所有匹配的DataReader。
3.监听与等待: 应用程序可以通过`监听器`或`条件等待`的方式异步或同步地获取新数据、状态改变等事件。

### 与相关技术的比较

| 特性 | DDS | ROS 2 (底层使用DDS) | MQTT | 传统Socket |
| :--- | :--- | :--- | :--- | :--- |
| 模型 | 以数据为中心的Pub/Sub | 以节点/服务为中心的Pub/Sub（基于DDS） | 以消息/主题为中心的Pub/Sub | 点对点 |
| 发现 | 自动、动态、去中心化 | 自动（依赖DDS） | 需要中央代理 | 手动配置 |
| QoS控制 | 极其丰富和精细 | 继承并简化了DDS QoS | 有限（几个等级） | 需手动实现 |
| 实时性 | 极高，为硬实时设计 | 高（取决于DDS实现） | 一般 | 高，但实现复杂 |
| 适用场景 | 军工、航空、自动驾驶、工业控制 | 机器人、研究原型 | IoT、移动推送、Web | 通用网络通信 |
