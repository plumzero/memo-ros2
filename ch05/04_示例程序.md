
将来自 Fast-DDS v3.4.1 版本下的 examples 的[一些程序](https://github.com/eProsima/Fast-DDS/tree/v3.4.1/examples/cpp)尝试编译。

### 编译

```s
export CMAKE_PREFIX_PATH=~/fastdds-dependency/fastcdr:~/fastdds-dependency/asio/include:~/fastdds-dependency/foonathan_memory:~/fastdds

cd examples
mkdir build & cd build

cmake ..
make -j4
```

### DomainParticipant 测试

在一个终端上执行 pub:
```s
./hello_world publisher
```

在另一个终端上执行 sub:
```s
./hello_world subscriber
```

将会看到两端各自发布、和订阅到的消息。

----
同一台主机上的 Fast DDS 默认会优先使用共享内存传输，这是为了获得最佳性能。如果共享内存不可用或配置禁用，则会回退到 UDP 环回传输。

可以查看 `/proc/<pid>/fd` 确认进程关联的共享内存文件。

本次测试使用的 DomainId 为 0，可以在 7401(组播端口，用于数据的广播)和 7411(单播端口，用于数据的单播)端口上抓包，查看是否有数据字段(例如这里传输的"Hello world"):

连接建立完成后，通信的双方会分别创建一个动态端口进行后续的数据传输，可以通过`netstat -anp | grep -E 'hello_world'`命令查询，笔者这里是:
```s
udp        0      0 0.0.0.0:59639           0.0.0.0:*                           9131/./hello_world  
udp        0      0 0.0.0.0:35344           0.0.0.0:*                           9119/./hello_world  
udp        0      0 0.0.0.0:7400            0.0.0.0:*                           9131/./hello_world  
udp        0      0 0.0.0.0:7400            0.0.0.0:*                           9119/./hello_world  
udp        0      0 0.0.0.0:7410            0.0.0.0:*                           9119/./hello_world  
udp        0      0 0.0.0.0:7411            0.0.0.0:*                           9119/./hello_world  
udp        0      0 0.0.0.0:7412            0.0.0.0:*                           9131/./hello_world  
udp        0      0 0.0.0.0:7413            0.0.0.0:*                           9131/./hello_world  
udp        0      0 192.168.45.226:41463    0.0.0.0:*                           9119/./hello_world  
udp        0      0 192.168.45.226:37724    0.0.0.0:*                           9131/./hello_world 
```
由于测试的双方运行在同一台机器上，所以双方数据传输的单播地址均为 192.168.45.226，端口分别是 41463 和 37724。分别在这两个端口上执行抓包:
```s
sudo tcpdump -i lo -vvv -X -n udp port 41463
sudo tcpdump -i lo -vvv -X -n udp port 37724
```
笔者抓包未发现预期数据，所以使用的是共享内存。

### RTPSParticipant 测试

RTPSParticipant 与 DomainParticipant 的区别查看[这里](Participant-Diff.md)。

在另一个终端上执行读取:
```s
./rtps reader
```

在一个终端上执行写入:
```s
./rtps writer
```

将会看到两端各自发布、和订阅到的消息。

### rpc 测试

在一端执行:
```s
./calculator server
```

在另一端执行:
```s
./calculator client --addition 1 2
```

观察输出。
